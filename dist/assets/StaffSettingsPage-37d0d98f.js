import{c as be,r as n,ac as ye,H as Y,j as e,s as je,T as H,q as Ne,t as R,K as N,M as Pe,R as V,a as B,u as Ce,h as Ie,i as Te,Y as k,m as Se,C as Fe,$ as Ee,ad as Re,a0 as _e,a1 as ke,B as E,ae as Ae,k as De,af as Me,L as T,I as S,ag as Le,ab as Ue}from"./index-349ace8f.js";import{u as J}from"./index-cf5354fc.js";const z=be("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var Ge=n.createContext(void 0);function Q(t){const a=n.useContext(Ge);return t||a||"ltr"}var U="rovingFocusGroup.onEntryFocus",Oe={bubbles:!1,cancelable:!0},A="RovingFocusGroup",[G,W,Ke]=ye(A),[Ve,X]=Y(A,[Ke]),[Be,$e]=Ve(A),Z=n.forwardRef((t,a)=>e.jsx(G.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(G.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(qe,{...t,ref:a})})}));Z.displayName=A;var qe=n.forwardRef((t,a)=>{const{__scopeRovingFocusGroup:s,orientation:o,loop:i=!1,dir:m,currentTabStopId:l,defaultCurrentTabStopId:v,onCurrentTabStopIdChange:b,onEntryFocus:g,preventScrollOnEntryFocus:r=!1,...c}=t,w=n.useRef(null),C=je(a,w),h=Q(m),[P,p]=H({prop:l,defaultProp:v??null,onChange:b,caller:A}),[j,_]=n.useState(!1),x=Ne(g),y=W(s),F=n.useRef(!1),[d,u]=n.useState(0);return n.useEffect(()=>{const f=w.current;if(f)return f.addEventListener(U,x),()=>f.removeEventListener(U,x)},[x]),e.jsx(Be,{scope:s,orientation:o,dir:h,loop:i,currentTabStopId:P,onItemFocus:n.useCallback(f=>p(f),[p]),onItemShiftTab:n.useCallback(()=>_(!0),[]),onFocusableItemAdd:n.useCallback(()=>u(f=>f+1),[]),onFocusableItemRemove:n.useCallback(()=>u(f=>f-1),[]),children:e.jsx(R.div,{tabIndex:j||d===0?-1:0,"data-orientation":o,...c,ref:C,style:{outline:"none",...t.style},onMouseDown:N(t.onMouseDown,()=>{F.current=!0}),onFocus:N(t.onFocus,f=>{const D=!F.current;if(f.target===f.currentTarget&&D&&!j){const q=new CustomEvent(U,Oe);if(f.currentTarget.dispatchEvent(q),!q.defaultPrevented){const L=y().filter(I=>I.focusable),ge=L.find(I=>I.active),we=L.find(I=>I.id===P),xe=[ge,we,...L].filter(Boolean).map(I=>I.ref.current);se(xe,r)}}F.current=!1}),onBlur:N(t.onBlur,()=>_(!1))})})}),ee="RovingFocusGroupItem",te=n.forwardRef((t,a)=>{const{__scopeRovingFocusGroup:s,focusable:o=!0,active:i=!1,tabStopId:m,children:l,...v}=t,b=J(),g=m||b,r=$e(ee,s),c=r.currentTabStopId===g,w=W(s),{onFocusableItemAdd:C,onFocusableItemRemove:h,currentTabStopId:P}=r;return n.useEffect(()=>{if(o)return C(),()=>h()},[o,C,h]),e.jsx(G.ItemSlot,{scope:s,id:g,focusable:o,active:i,children:e.jsx(R.span,{tabIndex:c?0:-1,"data-orientation":r.orientation,...v,ref:a,onMouseDown:N(t.onMouseDown,p=>{o?r.onItemFocus(g):p.preventDefault()}),onFocus:N(t.onFocus,()=>r.onItemFocus(g)),onKeyDown:N(t.onKeyDown,p=>{if(p.key==="Tab"&&p.shiftKey){r.onItemShiftTab();return}if(p.target!==p.currentTarget)return;const j=He(p,r.orientation,r.dir);if(j!==void 0){if(p.metaKey||p.ctrlKey||p.altKey||p.shiftKey)return;p.preventDefault();let x=w().filter(y=>y.focusable).map(y=>y.ref.current);if(j==="last")x.reverse();else if(j==="prev"||j==="next"){j==="prev"&&x.reverse();const y=x.indexOf(p.currentTarget);x=r.loop?Je(x,y+1):x.slice(y+1)}setTimeout(()=>se(x))}}),children:typeof l=="function"?l({isCurrentTabStop:c,hasTabStop:P!=null}):l})})});te.displayName=ee;var ze={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ye(t,a){return a!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function He(t,a,s){const o=Ye(t.key,s);if(!(a==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(a==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return ze[o]}function se(t,a=!1){const s=document.activeElement;for(const o of t)if(o===s||(o.focus({preventScroll:a}),document.activeElement!==s))return}function Je(t,a){return t.map((s,o)=>t[(a+o)%t.length])}var Qe=Z,We=te,M="Tabs",[Xe,ot]=Y(M,[X]),ae=X(),[Ze,$]=Xe(M),re=n.forwardRef((t,a)=>{const{__scopeTabs:s,value:o,onValueChange:i,defaultValue:m,orientation:l="horizontal",dir:v,activationMode:b="automatic",...g}=t,r=Q(v),[c,w]=H({prop:o,onChange:i,defaultProp:m??"",caller:M});return e.jsx(Ze,{scope:s,baseId:J(),value:c,onValueChange:w,orientation:l,dir:r,activationMode:b,children:e.jsx(R.div,{dir:r,"data-orientation":l,...g,ref:a})})});re.displayName=M;var oe="TabsList",ne=n.forwardRef((t,a)=>{const{__scopeTabs:s,loop:o=!0,...i}=t,m=$(oe,s),l=ae(s);return e.jsx(Qe,{asChild:!0,...l,orientation:m.orientation,dir:m.dir,loop:o,children:e.jsx(R.div,{role:"tablist","aria-orientation":m.orientation,...i,ref:a})})});ne.displayName=oe;var ie="TabsTrigger",le=n.forwardRef((t,a)=>{const{__scopeTabs:s,value:o,disabled:i=!1,...m}=t,l=$(ie,s),v=ae(s),b=ue(l.baseId,o),g=fe(l.baseId,o),r=o===l.value;return e.jsx(We,{asChild:!0,...v,focusable:!i,active:r,children:e.jsx(R.button,{type:"button",role:"tab","aria-selected":r,"aria-controls":g,"data-state":r?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:b,...m,ref:a,onMouseDown:N(t.onMouseDown,c=>{!i&&c.button===0&&c.ctrlKey===!1?l.onValueChange(o):c.preventDefault()}),onKeyDown:N(t.onKeyDown,c=>{[" ","Enter"].includes(c.key)&&l.onValueChange(o)}),onFocus:N(t.onFocus,()=>{const c=l.activationMode!=="manual";!r&&!i&&c&&l.onValueChange(o)})})})});le.displayName=ie;var ce="TabsContent",de=n.forwardRef((t,a)=>{const{__scopeTabs:s,value:o,forceMount:i,children:m,...l}=t,v=$(ce,s),b=ue(v.baseId,o),g=fe(v.baseId,o),r=o===v.value,c=n.useRef(r);return n.useEffect(()=>{const w=requestAnimationFrame(()=>c.current=!1);return()=>cancelAnimationFrame(w)},[]),e.jsx(Pe,{present:i||r,children:({present:w})=>e.jsx(R.div,{"data-state":r?"active":"inactive","data-orientation":v.orientation,role:"tabpanel","aria-labelledby":b,hidden:!w,id:g,tabIndex:0,...l,ref:a,style:{...t.style,animationDuration:c.current?"0s":void 0},children:w&&m})})});de.displayName=ce;function ue(t,a){return`${t}-trigger-${a}`}function fe(t,a){return`${t}-content-${a}`}var et=re,me=ne,pe=le,he=de;const tt=et,ve=V.forwardRef(({className:t,...a},s)=>e.jsx(me,{ref:s,className:B("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...a}));ve.displayName=me.displayName;const O=V.forwardRef(({className:t,...a},s)=>e.jsx(pe,{ref:s,className:B("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...a}));O.displayName=pe.displayName;const K=V.forwardRef(({className:t,...a},s)=>e.jsx(he,{ref:s,className:B("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...a}));K.displayName=he.displayName;const nt=()=>{var y,F;const{user:t,logout:a}=Ce(),{toast:s}=Ie(),o=Te(),[i,m]=n.useState({full_name:"",email:""}),[l,v]=n.useState(!0),[b,g]=n.useState(!1),[r,c]=n.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[w,C]=n.useState(!1),[h,P]=n.useState({current:!1,new:!1,confirm:!1});n.useEffect(()=>{t&&p()},[t]);const p=async()=>{var d;v(!0);try{const{data:u,error:f}=await k.from("profiles").select("full_name, email").eq("id",t.id).single();if(f)throw f;m({full_name:u.full_name||"",email:u.email||t.email||""})}catch(u){console.error("Error fetching profile:",u),s({variant:"destructive",title:"Error",description:"Failed to load profile data."}),m({full_name:((d=t.user_metadata)==null?void 0:d.name)||"",email:t.email||""})}finally{v(!1)}},j=async d=>{d.preventDefault(),g(!0);try{const{error:u}=await k.from("profiles").update({full_name:i.full_name,updated_at:new Date().toISOString()}).eq("id",t.id);if(u)throw u;if(i.email!==t.email){const{error:D}=await k.auth.updateUser({email:i.email});if(D)throw D;s({title:"Email Update",description:"A confirmation email has been sent to your new email address. Please check your inbox."})}const{error:f}=await k.auth.updateUser({data:{full_name:i.full_name}});f&&console.error("Metadata update error:",f),s({title:"Success",description:"Your profile has been updated successfully."})}catch(u){console.error("Error updating profile:",u),s({variant:"destructive",title:"Error",description:u.message||"Failed to update profile."})}finally{g(!1)}},_=async d=>{if(d.preventDefault(),r.newPassword!==r.confirmPassword){s({variant:"destructive",title:"Error",description:"New passwords do not match."});return}if(r.newPassword.length<6){s({variant:"destructive",title:"Error",description:"Password must be at least 6 characters long."});return}C(!0);try{const{error:u}=await k.auth.updateUser({password:r.newPassword});if(u)throw u;s({title:"Success",description:"Your password has been updated successfully."}),c({currentPassword:"",newPassword:"",confirmPassword:""})}catch(u){console.error("Error updating password:",u),s({variant:"destructive",title:"Error",description:u.message||"Failed to update password."})}finally{C(!1)}},x=async()=>{window.confirm("Are you sure you want to logout?")&&(await a(),o("/staff/login"))};return e.jsx(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-3xl mx-auto",children:e.jsxs(Fe,{className:"bg-white dark:bg-slate-800 shadow-xl",children:[e.jsx(Ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Re,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"}),e.jsxs("div",{children:[e.jsx(_e,{className:"text-2xl text-slate-800 dark:text-slate-100",children:"User Settings"}),e.jsx(ke,{className:"text-slate-600 dark:text-slate-400",children:"Manage your account settings and preferences"})]})]}),e.jsxs(E,{variant:"outline",onClick:x,className:"text-red-600 hover:text-red-700 hover:bg-red-100 dark:text-red-400 dark:hover:bg-red-700/50",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Logout"]})]})}),e.jsx(De,{children:e.jsxs(tt,{defaultValue:"profile",className:"w-full",children:[e.jsxs(ve,{className:"grid w-full grid-cols-2",children:[e.jsxs(O,{value:"profile",className:"flex items-center",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Profile"]}),e.jsxs(O,{value:"security",className:"flex items-center",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Security"]})]}),e.jsx(K,{value:"profile",className:"space-y-4 mt-6",children:e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"full_name",children:"Full Name"}),e.jsx(S,{id:"full_name",value:i.full_name,onChange:d=>m({...i,full_name:d.target.value}),placeholder:"Enter your full name",disabled:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"email",children:"Email Address"}),e.jsx(S,{id:"email",type:"email",value:i.email,onChange:d=>m({...i,email:d.target.value}),placeholder:"Enter your email",disabled:l}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Changing your email will require verification"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{children:"User ID"}),e.jsx(S,{value:(t==null?void 0:t.id)||"",disabled:!0,className:"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{children:"Role"}),e.jsx(S,{value:((F=(y=t==null?void 0:t.user_metadata)==null?void 0:y.role)==null?void 0:F.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase()))||"N/A",disabled:!0,className:"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400"})]}),e.jsx(E,{type:"submit",disabled:b||l,className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white",children:b?e.jsx(e.Fragment,{children:"Saving..."}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Save Profile"]})})]})}),e.jsxs(K,{value:"security",className:"space-y-4 mt-6",children:[e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-yellow-100 dark:bg-yellow-700/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Ue,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[e.jsx("p",{className:"font-semibold",children:"Password Requirements:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1",children:[e.jsx("li",{children:"Minimum 6 characters"}),e.jsx("li",{children:"Mix of letters and numbers recommended"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"currentPassword",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{id:"currentPassword",type:h.current?"text":"password",value:r.currentPassword,onChange:d=>c({...r,currentPassword:d.target.value}),placeholder:"Enter current password"}),e.jsx(E,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7",onClick:()=>P({...h,current:!h.current}),children:h.current?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{id:"newPassword",type:h.new?"text":"password",value:r.newPassword,onChange:d=>c({...r,newPassword:d.target.value}),placeholder:"Enter new password"}),e.jsx(E,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7",onClick:()=>P({...h,new:!h.new}),children:h.new?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{id:"confirmPassword",type:h.confirm?"text":"password",value:r.confirmPassword,onChange:d=>c({...r,confirmPassword:d.target.value}),placeholder:"Confirm new password"}),e.jsx(E,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7",onClick:()=>P({...h,confirm:!h.confirm}),children:h.confirm?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]})]}),e.jsx(E,{type:"submit",disabled:w||!r.newPassword||!r.confirmPassword,className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white",children:w?e.jsx(e.Fragment,{children:"Updating..."}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Update Password"]})})]}),e.jsx("div",{className:"mt-6 p-4 bg-slate-100 dark:bg-slate-700/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[e.jsx("strong",{children:"Note:"})," For security reasons, we don't validate your current password when changing it through Supabase Auth. Make sure to remember your new password."]})})]})]})})]})})};export{nt as default};
